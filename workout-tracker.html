<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal workout and walking tracker with progress charts">
    <meta name="theme-color" content="#a4b494">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout">
    <link rel="manifest" href="manifest.json">
    <title>WORKOUT.TRACKER</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23a4b494'/><circle cx='30' cy='50' r='15' fill='none' stroke='%231a1814' stroke-width='6'/><circle cx='70' cy='50' r='15' fill='none' stroke='%231a1814' stroke-width='6'/><rect x='42' y='46' width='16' height='8' fill='%231a1814'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg: #1a1814;
            --panel: #211e19;
            --border: #3d362c;
            --border-light: #4a4238;
            --text: #d4ccc0;
            --text-dim: #8a8075;
            --accent: #a4b494;
            --accent-dim: #a4b49480;
            --warning: #d4a574;
            --warning-dim: #d4a57440;
            --blue: #94a4b4;
            --blue-dim: #94a4b440;
            --purple: #c4a4a4;
            --purple-dim: #c4a4a440;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg);
            min-height: 100vh;
            padding: 30px;
            color: var(--text);
            background-image: 
                radial-gradient(ellipse at 20% 80%, #a4b49408 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, #d4a57408 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            border: 1px solid var(--border);
            background: var(--panel);
            padding: 20px 25px;
            margin-bottom: 20px;
            position: relative;
        }

        .header::before {
            content: '「TRAINING.SYSTEM」';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--bg);
            padding: 0 10px;
            font-size: 0.7rem;
            color: var(--accent);
            letter-spacing: 0.1em;
        }

        .header-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 0.15em;
            color: var(--text);
            margin-bottom: 8px;
        }

        .header-title span {
            color: var(--accent);
        }

        .header-sub {
            font-size: 0.8rem;
            color: var(--text-dim);
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .stat {
            font-size: 0.75rem;
        }

        .stat-label {
            color: var(--text-dim);
            display: block;
            margin-bottom: 5px;
        }

        .stat-value {
            color: var(--accent);
            font-size: 1.5rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 15px;
            background: var(--panel);
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-dim);
            letter-spacing: 0.05em;
            transition: all 0.2s;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
        }

        .tab-btn:hover {
            border-color: var(--border-light);
            color: var(--text);
        }

        .tab-btn.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .workout-day {
            border: 1px solid var(--border);
            background: var(--panel);
            position: relative;
        }

        .day-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--warning);
        }

        .day-tag {
            font-size: 0.65rem;
            padding: 4px 10px;
            border: 1px solid var(--border-light);
            color: var(--text-dim);
            letter-spacing: 0.1em;
        }

        .day-body {
            padding: 20px;
        }

        .exercise {
            margin-bottom: 25px;
            border-left: 2px solid var(--accent);
            padding-left: 15px;
        }

        .exercise:last-child {
            margin-bottom: 0;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .exercise-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progression-indicator {
            font-size: 0.9rem;
            padding: 4px 8px;
            border: 1px solid;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            animation: pulse 2s infinite;
        }

        .progression-indicator.increase {
            color: var(--accent);
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .progression-indicator.decrease {
            color: var(--warning);
            border-color: var(--warning);
            background: var(--warning-dim);
        }

        .progression-indicator .arrow {
            font-size: 1rem;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .last-workout-info {
            font-size: 0.65rem;
            color: var(--text-dim);
            padding: 8px 10px;
            background: rgba(0,0,0,0.3);
            border-left: 2px solid var(--border);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .last-workout-info .label {
            color: var(--text-dim);
        }

        .last-workout-info .value {
            color: var(--accent);
            font-weight: 700;
        }

        .exercise-target {
            font-size: 0.7rem;
            color: var(--text-dim);
            border: 1px dashed var(--border);
            padding: 3px 8px;
        }

        .sets-container {
            display: grid;
            gap: 8px;
        }

        .set-row {
            display: grid;
            grid-template-columns: 70px 1fr 1fr 80px;
            gap: 10px;
            align-items: center;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
        }

        .set-row.completed {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .set-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            letter-spacing: 0.05em;
        }

        .set-row input {
            padding: 8px 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 0.8rem;
            font-family: 'Space Mono', monospace;
            transition: border-color 0.2s;
        }

        .set-row input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .set-row input::placeholder {
            color: var(--text-dim);
            opacity: 0.5;
        }

        .complete-btn {
            padding: 8px;
            background: var(--panel);
            color: var(--accent);
            border: 1px solid var(--accent);
            cursor: pointer;
            font-weight: 700;
            font-size: 0.7rem;
            transition: all 0.2s;
            font-family: 'Space Mono', monospace;
            letter-spacing: 0.05em;
        }

        .complete-btn:hover {
            background: var(--accent-dim);
        }

        .complete-btn.completed {
            background: var(--accent);
            color: var(--bg);
        }

        .save-workout-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: var(--bg);
            border: 1px solid var(--accent);
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .save-workout-btn:hover {
            background: var(--bg);
            color: var(--accent);
        }

        .history-container {
            display: grid;
            gap: 15px;
        }

        .history-entry {
            background: var(--panel);
            padding: 15px 20px;
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border);
        }

        .history-day {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--warning);
            letter-spacing: 0.05em;
        }

        .history-date {
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 0.05em;
        }

        .history-exercises {
            display: grid;
            gap: 8px;
        }

        .history-exercise {
            font-size: 0.7rem;
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .history-exercise-name {
            color: var(--text);
        }

        .history-exercise-volume {
            color: var(--accent);
        }

        .clear-btn {
            padding: 10px 20px;
            background: var(--panel);
            color: var(--warning);
            border: 1px solid var(--warning);
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: var(--warning-dim);
        }

        .data-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .export-btn, .import-btn {
            padding: 10px 20px;
            background: var(--panel);
            border: 1px solid var(--blue);
            color: var(--blue);
            cursor: pointer;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .export-btn:hover, .import-btn:hover {
            background: var(--blue-dim);
        }

        .import-btn {
            position: relative;
        }

        #importFile {
            display: none;
        }

        .rest-timer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 24, 20, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .rest-timer-overlay.active {
            display: flex;
        }

        .rest-timer-content {
            border: 2px solid var(--accent);
            background: var(--panel);
            padding: 40px 60px;
            text-align: center;
            position: relative;
            max-width: 400px;
        }

        .rest-timer-content::before {
            content: '「REST.TIMER」';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg);
            padding: 0 15px;
            font-size: 0.7rem;
            color: var(--accent);
            letter-spacing: 0.1em;
        }

        .rest-timer-exercise {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            letter-spacing: 0.05em;
        }

        .rest-timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            font-weight: 900;
            color: var(--accent);
            margin: 20px 0;
            letter-spacing: 0.1em;
        }

        .rest-timer-display.warning {
            color: var(--warning);
            animation: pulse-warning 1s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .rest-timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            margin: 20px 0;
            overflow: hidden;
        }

        .rest-timer-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--warning));
            transition: width 1s linear;
        }

        .rest-timer-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .rest-timer-btn {
            flex: 1;
            padding: 12px 20px;
            background: var(--panel);
            border: 1px solid var(--border-light);
            color: var(--text);
            cursor: pointer;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            transition: all 0.2s;
        }

        .rest-timer-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .rest-timer-btn.skip {
            border-color: var(--warning);
            color: var(--warning);
        }

        .rest-timer-btn.skip:hover {
            background: var(--warning-dim);
        }

        .walking-timer-container {
            text-align: center;
            padding: 40px 20px;
        }

        .walking-timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 5rem;
            font-weight: 900;
            color: var(--accent);
            margin: 30px 0;
            letter-spacing: 0.1em;
        }

        .walking-timer-display.active {
            animation: pulse-timer 2s infinite;
        }

        @keyframes pulse-timer {
            0%, 100% { color: var(--accent); }
            50% { color: var(--warning); }
        }

        .walking-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .walking-btn {
            padding: 15px 30px;
            background: var(--panel);
            border: 2px solid var(--accent);
            color: var(--accent);
            cursor: pointer;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            transition: all 0.2s;
            text-transform: uppercase;
            min-width: 150px;
        }

        .walking-btn:hover {
            background: var(--accent-dim);
        }

        .walking-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: var(--border);
            color: var(--text-dim);
        }

        .walking-btn.stop {
            border-color: var(--warning);
            color: var(--warning);
        }

        .walking-btn.stop:hover {
            background: var(--warning-dim);
        }

        .walking-history {
            margin-top: 40px;
        }

        .walking-entry {
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .walking-entry-date {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .walking-entry-duration {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--accent);
            font-weight: 700;
        }

        .walking-week-progress {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .walking-week-header {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 15px;
            letter-spacing: 0.05em;
        }

        .walking-week-dots {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .walking-dot {
            width: 60px;
            height: 60px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .walking-dot.completed {
            border-color: var(--accent);
            background: var(--accent-dim);
            color: var(--accent);
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .chart-container {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .chart-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--warning);
            margin-bottom: 15px;
            letter-spacing: 0.05em;
        }

        .chart-selector {
            margin-bottom: 20px;
        }

        .chart-selector select {
            width: 100%;
            padding: 12px;
            background: var(--panel);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .chart-selector select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .progress-container {
            display: grid;
            gap: 12px;
        }

        .progress-bar-container {
            display: grid;
            gap: 8px;
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--text);
            letter-spacing: 0.05em;
        }

        .progress-bar-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-bg {
            flex: 1;
            height: 25px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--warning));
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .progress-bar-text {
            font-size: 0.7rem;
            color: var(--bg);
            font-weight: 700;
        }

        .progress-value {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: 700;
            min-width: 60px;
            text-align: right;
        }

        .section-header {
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-header::before {
            content: '▸';
            color: var(--accent);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dim);
            font-size: 0.8rem;
            border: 1px dashed var(--border);
            background: rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .set-row {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-btn {
                min-width: 100%;
            }

            .stats-bar {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">WORKOUT<span>.TRACKER</span></div>
            <div class="header-sub">DUMBBELL PROTOCOL // 4-DAY SPLIT</div>
            <div class="stats-bar">
                <div class="stat">
                    <span class="stat-label">TOTAL.SESSIONS</span>
                    <span class="stat-value" id="totalWorkouts">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">THIS.WEEK</span>
                    <span class="stat-value" id="weekWorkouts">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">WALKS.WEEK</span>
                    <span class="stat-value" id="weekWalks">0<span style="font-size: 0.6em; color: var(--text-dim);">/3</span></span>
                </div>
                <div class="stat">
                    <span class="stat-label">STREAK.DAYS</span>
                    <span class="stat-value" id="streak">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">TOTAL.VOLUME</span>
                    <span class="stat-value" id="totalVolume">0<span style="font-size: 0.6em; color: var(--text-dim);">kg</span></span>
                </div>
            </div>
            <div class="data-controls">
                <button class="export-btn" onclick="exportData('json')">↓ EXPORT.JSON</button>
                <button class="export-btn" onclick="exportData('csv')">↓ EXPORT.CSV</button>
                <label for="importFile" class="import-btn">↑ IMPORT.DATA</label>
                <input type="file" id="importFile" accept=".json,.csv" onchange="importData(event)">
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('day1')">DAY 1: UPPER.PUSH</button>
            <button class="tab-btn" onclick="showTab('day2')">DAY 2: LOWER.BODY</button>
            <button class="tab-btn" onclick="showTab('day3')">DAY 3: UPPER.PULL</button>
            <button class="tab-btn" onclick="showTab('day4')">DAY 4: FULL.BODY</button>
            <button class="tab-btn" onclick="showTab('walking')">WALKING</button>
            <button class="tab-btn" onclick="showTab('charts')">CHARTS</button>
            <button class="tab-btn" onclick="showTab('history')">HISTORY</button>
            <button class="tab-btn" onclick="showTab('progress')">PROGRESS</button>
        </div>

        <!-- Day 1: Upper Push -->
        <div id="day1" class="tab-content active">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">DAY 1: UPPER.PUSH</div>
                    <div class="day-tag">11 SETS TOTAL</div>
                </div>
                <div class="day-body">
                    <div class="exercise" data-exercise="Dumbbell Bench Press">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL BENCH PRESS</div>
                            <div class="exercise-target">3×8-10</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Incline Dumbbell Press">
                        <div class="exercise-header">
                            <div class="exercise-name">INCLINE DUMBBELL PRESS</div>
                            <div class="exercise-target">3×8-10</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Shoulder Press">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL SHOULDER PRESS</div>
                            <div class="exercise-target">3×10-12</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Tricep Extensions">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL TRICEP EXTENSIONS</div>
                            <div class="exercise-target">2×12-15</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <button class="save-workout-btn" onclick="saveWorkout('day1')">SAVE.WORKOUT</button>
                </div>
            </div>
        </div>

        <!-- Day 2: Lower Body -->
        <div id="day2" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">DAY 2: LOWER.BODY</div>
                    <div class="day-tag">11 SETS TOTAL</div>
                </div>
                <div class="day-body">
                    <div class="exercise" data-exercise="Goblet Squats">
                        <div class="exercise-header">
                            <div class="exercise-name">GOBLET SQUATS</div>
                            <div class="exercise-target">3×10-12</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Romanian Deadlifts">
                        <div class="exercise-header">
                            <div class="exercise-name">ROMANIAN DEADLIFTS</div>
                            <div class="exercise-target">3×8-10</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Bulgarian Split Squats">
                        <div class="exercise-header">
                            <div class="exercise-name">BULGARIAN SPLIT SQUATS</div>
                            <div class="exercise-target">3×8-10/LEG</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Calf Raises">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL CALF RAISES</div>
                            <div class="exercise-target">2×15-20</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <button class="save-workout-btn" onclick="saveWorkout('day2')">SAVE.WORKOUT</button>
                </div>
            </div>
        </div>

        <!-- Day 3: Upper Pull -->
        <div id="day3" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">DAY 3: UPPER.PULL</div>
                    <div class="day-tag">11 SETS TOTAL</div>
                </div>
                <div class="day-body">
                    <div class="exercise" data-exercise="Dumbbell Rows">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL ROWS</div>
                            <div class="exercise-target">3×8-10/ARM</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Chest-Supported Dumbbell Rows">
                        <div class="exercise-header">
                            <div class="exercise-name">CHEST-SUPPORTED ROWS</div>
                            <div class="exercise-target">3×10-12</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Pullovers">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL PULLOVERS</div>
                            <div class="exercise-target">3×10-12</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Bicep Curls">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL BICEP CURLS</div>
                            <div class="exercise-target">2×12-15</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">SET.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">SET.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <button class="save-workout-btn" onclick="saveWorkout('day3')">SAVE.WORKOUT</button>
                </div>
            </div>
        </div>

        <!-- Day 4: Full Body Circuit -->
        <div id="day4" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">DAY 4: FULL.BODY</div>
                    <div class="day-tag">3-4 ROUNDS</div>
                </div>
                <div class="day-body">
                    <div class="exercise" data-exercise="Dumbbell Thrusters">
                        <div class="exercise-header">
                            <div class="exercise-name">DUMBBELL THRUSTERS</div>
                            <div class="exercise-target">10 REPS/ROUND</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">RND.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.4</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Dumbbell Romanian Deadlifts (Circuit)">
                        <div class="exercise-header">
                            <div class="exercise-name">ROMANIAN DEADLIFTS</div>
                            <div class="exercise-target">12 REPS/ROUND</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">RND.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.4</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Renegade Rows">
                        <div class="exercise-header">
                            <div class="exercise-name">RENEGADE ROWS</div>
                            <div class="exercise-target">8 REPS/ARM</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">RND.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.4</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <div class="exercise" data-exercise="Goblet Squats (Circuit)">
                        <div class="exercise-header">
                            <div class="exercise-name">GOBLET SQUATS</div>
                            <div class="exercise-target">12 REPS/ROUND</div>
                        </div>
                        <div class="sets-container">
                            <div class="set-row">
                                <span class="set-label">RND.1</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.2</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.3</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                            <div class="set-row">
                                <span class="set-label">RND.4</span>
                                <input type="number" placeholder="KG" class="weight" step="0.5">
                                <input type="number" placeholder="REPS" class="reps">
                                <button class="complete-btn" onclick="toggleComplete(this)">✓</button>
                            </div>
                        </div>
                    </div>

                    <button class="save-workout-btn" onclick="saveWorkout('day4')">SAVE.WORKOUT</button>
                </div>
            </div>
        </div>

        <!-- Walking Tab -->
        <div id="walking" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">WALKING.TRACKER</div>
                    <div class="day-tag">GOAL: 3×30MIN/WEEK</div>
                </div>
                <div class="day-body">
                    <div class="walking-timer-container">
                        <div class="walking-timer-display" id="walkingTimerDisplay">00:00</div>
                        <div class="walking-controls">
                            <button class="walking-btn" id="walkStartBtn" onclick="startWalk()">START WALK</button>
                            <button class="walking-btn stop" id="walkStopBtn" onclick="stopWalk()" disabled>STOP WALK</button>
                        </div>
                    </div>

                    <div class="walking-week-progress">
                        <div class="walking-week-header">THIS WEEK'S PROGRESS</div>
                        <div class="walking-week-dots">
                            <div class="walking-dot" id="walkDot1">1</div>
                            <div class="walking-dot" id="walkDot2">2</div>
                            <div class="walking-dot" id="walkDot3">3</div>
                        </div>
                    </div>

                    <div class="walking-history">
                        <div class="section-header">WALK HISTORY</div>
                        <div id="walkingHistoryContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="charts" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">PROGRESS.CHARTS</div>
                    <div class="day-tag">VISUAL ANALYTICS</div>
                </div>
                <div class="day-body">
                    <div class="chart-selector">
                        <select id="exerciseSelect" onchange="updateChart()">
                            <option value="">SELECT EXERCISE</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title" id="chartTitle">SELECT AN EXERCISE TO VIEW PROGRESS</div>
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">WORKOUT.HISTORY</div>
                    <button class="clear-btn" onclick="clearHistory()">CLEAR.ALL</button>
                </div>
                <div class="day-body">
                    <div class="section-header">SESSION LOG</div>
                    <div id="historyContainer" class="history-container"></div>
                </div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <div class="workout-day">
                <div class="day-header">
                    <div class="day-title">PROGRESS.TRACKING</div>
                    <div class="day-tag">MAX WEIGHTS</div>
                </div>
                <div class="day-body">
                    <div class="section-header">EXERCISE MAXIMUMS</div>
                    <div id="progressContainer" class="progress-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rest Timer Overlay -->
    <div id="restTimerOverlay" class="rest-timer-overlay">
        <div class="rest-timer-content">
            <div class="rest-timer-exercise" id="restExerciseName">EXERCISE NAME</div>
            <div class="rest-timer-display" id="restTimerDisplay">0:00</div>
            <div class="rest-timer-bar">
                <div class="rest-timer-bar-fill" id="restTimerBar"></div>
            </div>
            <div class="rest-timer-controls">
                <button class="rest-timer-btn" onclick="addRestTime(30)">+30s</button>
                <button class="rest-timer-btn skip" onclick="skipRestTimer()">SKIP</button>
                <button class="rest-timer-btn" onclick="addRestTime(-30)">-30s</button>
            </div>
        </div>
    </div>

    <script>
        // Exercise target rep ranges
        const REP_RANGES = {
            'Dumbbell Bench Press': { min: 8, max: 10 },
            'Incline Dumbbell Press': { min: 8, max: 10 },
            'Dumbbell Shoulder Press': { min: 10, max: 12 },
            'Dumbbell Tricep Extensions': { min: 12, max: 15 },
            'Goblet Squats': { min: 10, max: 12 },
            'Romanian Deadlifts': { min: 8, max: 10 },
            'Bulgarian Split Squats': { min: 8, max: 10 },
            'Dumbbell Calf Raises': { min: 15, max: 20 },
            'Dumbbell Rows': { min: 8, max: 10 },
            'Chest-Supported Dumbbell Rows': { min: 10, max: 12 },
            'Dumbbell Pullovers': { min: 10, max: 12 },
            'Dumbbell Bicep Curls': { min: 12, max: 15 },
            'Dumbbell Thrusters': { min: 10, max: 10 },
            'Dumbbell Romanian Deadlifts (Circuit)': { min: 12, max: 12 },
            'Renegade Rows': { min: 8, max: 8 },
            'Goblet Squats (Circuit)': { min: 12, max: 12 }
        };

        // Rest time recommendations (in seconds)
        const REST_TIMES = {
            'compound_heavy': 180,      // 3 minutes for heavy compounds (bench, rows, deadlifts, squats)
            'compound_moderate': 120,    // 2 minutes for moderate compounds (shoulder press, pullovers)
            'isolation': 90,             // 1.5 minutes for isolation exercises
            'circuit': 60                // 1 minute for circuit exercises
        };

        // Exercise category mapping
        function getExerciseCategory(exerciseName) {
            const heavy = ['Dumbbell Bench Press', 'Incline Dumbbell Press', 'Romanian Deadlifts', 
                          'Goblet Squats', 'Bulgarian Split Squats', 'Dumbbell Rows', 
                          'Chest-Supported Dumbbell Rows'];
            const moderate = ['Dumbbell Shoulder Press', 'Dumbbell Pullovers'];
            const circuit = ['Dumbbell Thrusters', 'Dumbbell Romanian Deadlifts (Circuit)', 
                           'Renegade Rows', 'Goblet Squats (Circuit)'];
            
            if (circuit.includes(exerciseName)) return 'circuit';
            if (heavy.includes(exerciseName)) return 'compound_heavy';
            if (moderate.includes(exerciseName)) return 'compound_moderate';
            return 'isolation';
        }

        // Rest timer state
        let restTimerInterval = null;
        let restTimeRemaining = 0;
        let restTimerTotal = 0;

        // Start rest timer
        function startRestTimer(exerciseName) {
            const category = getExerciseCategory(exerciseName);
            restTimerTotal = REST_TIMES[category];
            restTimeRemaining = restTimerTotal;
            
            const overlay = document.getElementById('restTimerOverlay');
            const display = document.getElementById('restTimerDisplay');
            const exerciseLabel = document.getElementById('restExerciseName');
            const bar = document.getElementById('restTimerBar');
            
            exerciseLabel.textContent = exerciseName.toUpperCase();
            overlay.classList.add('active');
            
            // Clear any existing timer
            if (restTimerInterval) {
                clearInterval(restTimerInterval);
            }
            
            // Update display immediately
            updateRestTimerDisplay();
            
            // Start countdown
            restTimerInterval = setInterval(() => {
                restTimeRemaining--;
                updateRestTimerDisplay();
                
                if (restTimeRemaining <= 0) {
                    clearInterval(restTimerInterval);
                    // Play completion sound (beep simulation with visual cue)
                    display.classList.add('warning');
                    setTimeout(() => {
                        skipRestTimer();
                    }, 1000);
                }
            }, 1000);
        }

        // Update rest timer display
        function updateRestTimerDisplay() {
            const display = document.getElementById('restTimerDisplay');
            const bar = document.getElementById('restTimerBar');
            
            const minutes = Math.floor(Math.abs(restTimeRemaining) / 60);
            const seconds = Math.abs(restTimeRemaining) % 60;
            const sign = restTimeRemaining < 0 ? '-' : '';
            
            display.textContent = `${sign}${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Update progress bar
            const percentage = Math.max(0, Math.min(100, (1 - (restTimeRemaining / restTimerTotal)) * 100));
            bar.style.width = percentage + '%';
            
            // Add warning class when time is running out or overtime
            if (restTimeRemaining <= 10 || restTimeRemaining < 0) {
                display.classList.add('warning');
            } else {
                display.classList.remove('warning');
            }
        }

        // Add or subtract rest time
        function addRestTime(seconds) {
            restTimeRemaining += seconds;
            restTimerTotal = Math.max(restTimerTotal, restTimeRemaining);
            updateRestTimerDisplay();
        }

        // Skip rest timer
        function skipRestTimer() {
            if (restTimerInterval) {
                clearInterval(restTimerInterval);
                restTimerInterval = null;
            }
            
            const overlay = document.getElementById('restTimerOverlay');
            const display = document.getElementById('restTimerDisplay');
            
            overlay.classList.remove('active');
            display.classList.remove('warning');
        }

        // Walking timer state
        let walkingInterval = null;
        let walkingSeconds = 0;
        let walkStartTime = null;

        // Start walking timer
        function startWalk() {
            walkStartTime = Date.now();
            walkingSeconds = 0;
            
            const display = document.getElementById('walkingTimerDisplay');
            const startBtn = document.getElementById('walkStartBtn');
            const stopBtn = document.getElementById('walkStopBtn');
            
            display.classList.add('active');
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            walkingInterval = setInterval(() => {
                walkingSeconds++;
                updateWalkingDisplay();
            }, 1000);
        }

        // Update walking display
        function updateWalkingDisplay() {
            const display = document.getElementById('walkingTimerDisplay');
            const minutes = Math.floor(walkingSeconds / 60);
            const seconds = walkingSeconds % 60;
            display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Stop walking timer
        function stopWalk() {
            if (walkingInterval) {
                clearInterval(walkingInterval);
                walkingInterval = null;
            }
            
            const display = document.getElementById('walkingTimerDisplay');
            const startBtn = document.getElementById('walkStartBtn');
            const stopBtn = document.getElementById('walkStopBtn');
            
            display.classList.remove('active');
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            // Save walk if longer than 1 minute
            if (walkingSeconds >= 60) {
                const walkData = {
                    date: new Date().toISOString(),
                    duration: walkingSeconds
                };
                
                let walks = JSON.parse(localStorage.getItem('walkingHistory') || '[]');
                walks.unshift(walkData);
                localStorage.setItem('walkingHistory', JSON.stringify(walks));
                
                alert(`「WALK.SAVED」Duration: ${Math.floor(walkingSeconds / 60)} minutes ${walkingSeconds % 60} seconds`);
                loadWalkingHistory();
                updateStats();
            }
            
            // Reset display
            walkingSeconds = 0;
            display.textContent = '00:00';
        }

        // Load walking history
        function loadWalkingHistory() {
            const walks = JSON.parse(localStorage.getItem('walkingHistory') || '[]');
            const container = document.getElementById('walkingHistoryContainer');
            
            if (walks.length === 0) {
                container.innerHTML = '<div class="empty-state">「NO.WALKS」Start your first walk to track progress.</div>';
                updateWalkingProgress(0);
                return;
            }
            
            // Get this week's walks
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weekWalks = walks.filter(w => new Date(w.date) > oneWeekAgo);
            updateWalkingProgress(weekWalks.length);
            
            container.innerHTML = '';
            
            walks.slice(0, 10).forEach(walk => {
                const date = new Date(walk.date);
                const minutes = Math.floor(walk.duration / 60);
                const seconds = walk.duration % 60;
                
                const entry = document.createElement('div');
                entry.className = 'walking-entry';
                entry.innerHTML = `
                    <div class="walking-entry-date">${date.toLocaleDateString()} • ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    <div class="walking-entry-duration">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                `;
                container.appendChild(entry);
            });
        }

        // Update walking progress dots
        function updateWalkingProgress(count) {
            for (let i = 1; i <= 3; i++) {
                const dot = document.getElementById(`walkDot${i}`);
                if (i <= count) {
                    dot.classList.add('completed');
                    dot.textContent = '✓';
                } else {
                    dot.classList.remove('completed');
                    dot.textContent = i.toString();
                }
            }
        }

        // Chart.js instance
        let progressChart = null;

        // Initialize charts
        function initializeCharts() {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            const exerciseSelect = document.getElementById('exerciseSelect');
            
            // Get unique exercises
            const exercises = new Set();
            history.forEach(workout => {
                workout.exercises.forEach(ex => exercises.add(ex.name));
            });
            
            // Populate dropdown
            exerciseSelect.innerHTML = '<option value="">SELECT EXERCISE</option>';
            Array.from(exercises).sort().forEach(exercise => {
                const option = document.createElement('option');
                option.value = exercise;
                option.textContent = exercise;
                exerciseSelect.appendChild(option);
            });
        }

        // Update chart
        function updateChart() {
            const exerciseSelect = document.getElementById('exerciseSelect');
            const exerciseName = exerciseSelect.value;
            
            if (!exerciseName) {
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                document.getElementById('chartTitle').textContent = 'SELECT AN EXERCISE TO VIEW PROGRESS';
                return;
            }
            
            document.getElementById('chartTitle').textContent = exerciseName.toUpperCase();
            
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            
            // Extract data for selected exercise
            const dataPoints = [];
            history.reverse().forEach(workout => {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.sets.length > 0) {
                    const date = new Date(workout.date);
                    const maxWeight = Math.max(...exercise.sets.map(s => s.weight));
                    const avgWeight = exercise.sets.reduce((sum, s) => sum + s.weight, 0) / exercise.sets.length;
                    const totalVolume = exercise.sets.reduce((sum, s) => sum + (s.weight * s.reps), 0);
                    
                    dataPoints.push({
                        date: date,
                        dateStr: date.toLocaleDateString(),
                        maxWeight: maxWeight,
                        avgWeight: avgWeight,
                        totalVolume: totalVolume
                    });
                }
            });
            
            if (dataPoints.length === 0) {
                if (progressChart) {
                    progressChart.destroy();
                    progressChart = null;
                }
                return;
            }
            
            // Create chart
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dataPoints.map(d => d.dateStr),
                    datasets: [
                        {
                            label: 'Max Weight (kg)',
                            data: dataPoints.map(d => d.maxWeight),
                            borderColor: '#a4b494',
                            backgroundColor: 'rgba(164, 180, 148, 0.1)',
                            borderWidth: 3,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'Avg Weight (kg)',
                            data: dataPoints.map(d => d.avgWeight),
                            borderColor: '#d4a574',
                            backgroundColor: 'rgba(212, 165, 116, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#d4ccc0',
                                font: {
                                    family: 'Space Mono',
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#211e19',
                            titleColor: '#d4ccc0',
                            bodyColor: '#d4ccc0',
                            borderColor: '#3d362c',
                            borderWidth: 1,
                            titleFont: {
                                family: 'Space Mono',
                                size: 12
                            },
                            bodyFont: {
                                family: 'Space Mono',
                                size: 11
                            },
                            callbacks: {
                                afterBody: function(context) {
                                    const index = context[0].dataIndex;
                                    return 'Volume: ' + Math.round(dataPoints[index].totalVolume) + 'kg';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#8a8075',
                                font: {
                                    family: 'Space Mono',
                                    size: 10
                                }
                            },
                            grid: {
                                color: '#3d362c'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                color: '#8a8075',
                                font: {
                                    family: 'Space Mono',
                                    size: 10
                                },
                                callback: function(value) {
                                    return value + 'kg';
                                }
                            },
                            grid: {
                                color: '#3d362c'
                            }
                        }
                    }
                }
            });
        }

        // Get last workout for specific exercise
        function getLastWorkoutData(exerciseName) {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            
            for (let workout of history) {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.sets.length > 0) {
                    return {
                        sets: exercise.sets,
                        date: workout.date
                    };
                }
            }
            return null;
        }

        // Get failure count for exercise (times failed to hit rep range)
        function getFailureCount(exerciseName) {
            const failureData = JSON.parse(localStorage.getItem('exerciseFailures') || '{}');
            return failureData[exerciseName] || 0;
        }

        // Update failure count
        function updateFailureCount(exerciseName, increment) {
            const failureData = JSON.parse(localStorage.getItem('exerciseFailures') || '{}');
            if (increment) {
                failureData[exerciseName] = (failureData[exerciseName] || 0) + 1;
            } else {
                failureData[exerciseName] = 0;
            }
            localStorage.setItem('exerciseFailures', JSON.stringify(failureData));
        }

        // Check if should show progression indicator
        function checkProgression(exerciseName, lastWorkout) {
            if (!lastWorkout) return null;
            
            const repRange = REP_RANGES[exerciseName];
            if (!repRange) return null;

            // Check if all sets exceeded max reps
            const allSetsExceeded = lastWorkout.sets.every(set => set.reps > repRange.max);
            if (allSetsExceeded) {
                return 'increase';
            }

            // Check if failed 3+ times
            const failureCount = getFailureCount(exerciseName);
            if (failureCount >= 3) {
                return 'decrease';
            }

            return null;
        }

        // Load last workout and pre-fill
        function loadLastWorkoutData() {
            const exercises = document.querySelectorAll('.exercise');
            
            exercises.forEach(exercise => {
                const exerciseName = exercise.getAttribute('data-exercise');
                const lastWorkout = getLastWorkoutData(exerciseName);
                
                if (lastWorkout) {
                    // Pre-fill weight inputs
                    const setRows = exercise.querySelectorAll('.set-row');
                    lastWorkout.sets.forEach((set, index) => {
                        if (setRows[index]) {
                            const weightInput = setRows[index].querySelector('.weight');
                            if (weightInput) {
                                weightInput.value = set.weight;
                                weightInput.style.color = 'var(--text-dim)';
                            }
                        }
                    });

                    // Add last workout info display
                    const exerciseHeader = exercise.querySelector('.exercise-header');
                    const lastDate = new Date(lastWorkout.date);
                    const avgWeight = (lastWorkout.sets.reduce((sum, set) => sum + set.weight, 0) / lastWorkout.sets.length).toFixed(1);
                    const avgReps = Math.round(lastWorkout.sets.reduce((sum, set) => sum + set.reps, 0) / lastWorkout.sets.length);
                    
                    const lastInfo = document.createElement('div');
                    lastInfo.className = 'last-workout-info';
                    lastInfo.innerHTML = `
                        <span class="label">LAST: ${lastDate.toLocaleDateString()}</span>
                        <span class="value">${avgWeight}kg × ${avgReps} reps</span>
                    `;
                    exerciseHeader.parentNode.insertBefore(lastInfo, exerciseHeader.nextSibling);

                    // Check and add progression indicator
                    const progression = checkProgression(exerciseName, lastWorkout);
                    if (progression) {
                        const nameEl = exercise.querySelector('.exercise-name');
                        const indicator = document.createElement('span');
                        indicator.className = `progression-indicator ${progression}`;
                        
                        if (progression === 'increase') {
                            indicator.innerHTML = '<span class="arrow">↑</span><span>INCREASE</span>';
                        } else {
                            indicator.innerHTML = '<span class="arrow">↓</span><span>DELOAD</span>';
                        }
                        
                        nameEl.appendChild(indicator);
                    }
                }
            });
        }

        // Tab switching
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            if (tabId === 'history') {
                loadHistory();
            } else if (tabId === 'progress') {
                loadProgress();
            } else if (tabId === 'walking') {
                loadWalkingHistory();
            } else if (tabId === 'charts') {
                initializeCharts();
            }
        }

        // Toggle complete button
        function toggleComplete(button) {
            const setRow = button.closest('.set-row');
            const wasCompleted = button.classList.contains('completed');
            
            button.classList.toggle('completed');
            setRow.classList.toggle('completed');
            
            // Start rest timer when completing a set (not when uncompleting)
            if (!wasCompleted) {
                const exercise = button.closest('.exercise');
                const exerciseName = exercise.getAttribute('data-exercise');
                
                // Check if there are more sets to do in this exercise
                const allSetRows = exercise.querySelectorAll('.set-row');
                const currentSetIndex = Array.from(allSetRows).indexOf(setRow);
                const hasMoreSets = currentSetIndex < allSetRows.length - 1;
                
                // Only start timer if there are more sets
                if (hasMoreSets) {
                    startRestTimer(exerciseName);
                }
            } else {
                // If uncompleting, stop the timer if it's running
                skipRestTimer();
            }
        }

        // Save workout
        function saveWorkout(day) {
            const dayContent = document.getElementById(day);
            const exercises = dayContent.querySelectorAll('.exercise');
            const workoutData = {
                day: day,
                date: new Date().toISOString(),
                exercises: []
            };

            exercises.forEach(exercise => {
                const exerciseName = exercise.getAttribute('data-exercise');
                const sets = [];
                const setRows = exercise.querySelectorAll('.set-row');
                
                setRows.forEach(row => {
                    const weight = row.querySelector('.weight').value;
                    const reps = row.querySelector('.reps').value;
                    const completed = row.querySelector('.complete-btn').classList.contains('completed');
                    
                    if (weight && reps) {
                        sets.push({
                            weight: parseFloat(weight),
                            reps: parseInt(reps),
                            completed: completed
                        });
                    }
                });

                if (sets.length > 0) {
                    workoutData.exercises.push({
                        name: exerciseName,
                        sets: sets
                    });

                    // Update failure count based on performance
                    const repRange = REP_RANGES[exerciseName];
                    if (repRange) {
                        const failedSets = sets.filter(set => set.reps < repRange.min).length;
                        const exceededSets = sets.filter(set => set.reps > repRange.max).length;
                        
                        if (failedSets > sets.length / 2) {
                            // Failed more than half the sets
                            updateFailureCount(exerciseName, true);
                        } else if (exceededSets === sets.length) {
                            // Exceeded all sets - ready to progress
                            updateFailureCount(exerciseName, false);
                        }
                    }
                }
            });

            if (workoutData.exercises.length > 0) {
                let history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                history.unshift(workoutData);
                localStorage.setItem('workoutHistory', JSON.stringify(history));
                
                alert('「WORKOUT.SAVED」Session data logged successfully.');
                updateStats();
                clearWorkoutInputs(day);
                
                // Reload page to show new progression indicators
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                alert('「ERROR」Enter at least one complete set before saving.');
            }
        }

        // Clear workout inputs after saving
        function clearWorkoutInputs(day) {
            const dayContent = document.getElementById(day);
            const inputs = dayContent.querySelectorAll('input');
            const buttons = dayContent.querySelectorAll('.complete-btn');
            const rows = dayContent.querySelectorAll('.set-row');
            
            inputs.forEach(input => input.value = '');
            buttons.forEach(btn => btn.classList.remove('completed'));
            rows.forEach(row => row.classList.remove('completed'));
        }

        // Update statistics
        function updateStats() {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            
            // Total workouts
            document.getElementById('totalWorkouts').textContent = history.length;
            
            // This week's workouts
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weekWorkouts = history.filter(w => new Date(w.date) > oneWeekAgo).length;
            document.getElementById('weekWorkouts').textContent = weekWorkouts;
            
            // This week's walks
            const walks = JSON.parse(localStorage.getItem('walkingHistory') || '[]');
            const weekWalks = walks.filter(w => new Date(w.date) > oneWeekAgo).length;
            document.getElementById('weekWalks').innerHTML = weekWalks + '<span style="font-size: 0.6em; color: var(--text-dim);">/3</span>';
            
            // Calculate streak
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const workoutDates = history.map(w => {
                const d = new Date(w.date);
                d.setHours(0, 0, 0, 0);
                return d.getTime();
            }).filter((v, i, a) => a.indexOf(v) === i).sort((a, b) => b - a);
            
            for (let i = 0; i < workoutDates.length; i++) {
                const daysDiff = Math.floor((today - workoutDates[i]) / (1000 * 60 * 60 * 24));
                if (daysDiff === i) {
                    streak++;
                } else {
                    break;
                }
            }
            document.getElementById('streak').textContent = streak;
            
            // Total volume
            let totalVolume = 0;
            history.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    exercise.sets.forEach(set => {
                        totalVolume += set.weight * set.reps;
                    });
                });
            });
            document.getElementById('totalVolume').innerHTML = Math.round(totalVolume) + '<span style="font-size: 0.6em; color: var(--text-dim);">kg</span>';
        }

        // Load history
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            const container = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-state">「NO.DATA」Complete your first workout to see history.</div>';
                return;
            }
            
            container.innerHTML = '';
            
            const dayNames = {
                'day1': 'DAY 1: UPPER.PUSH',
                'day2': 'DAY 2: LOWER.BODY',
                'day3': 'DAY 3: UPPER.PULL',
                'day4': 'DAY 4: FULL.BODY'
            };
            
            history.forEach((workout, index) => {
                const date = new Date(workout.date);
                
                const entry = document.createElement('div');
                entry.className = 'history-entry';
                
                let exercisesHTML = '';
                workout.exercises.forEach(exercise => {
                    const totalVolume = exercise.sets.reduce((sum, set) => sum + (set.weight * set.reps), 0);
                    exercisesHTML += `
                        <div class="history-exercise">
                            <span class="history-exercise-name">${exercise.name}</span>
                            <span class="history-exercise-volume">${exercise.sets.length} sets • ${Math.round(totalVolume)}kg</span>
                        </div>
                    `;
                });
                
                entry.innerHTML = `
                    <div class="history-header">
                        <div class="history-day">${dayNames[workout.day]}</div>
                        <div class="history-date">${date.toLocaleDateString()} • ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>
                    <div class="history-exercises">${exercisesHTML}</div>
                `;
                
                container.appendChild(entry);
            });
        }

        // Load progress
        function loadProgress() {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            const container = document.getElementById('progressContainer');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-state">「NO.DATA」Complete workouts to track progress.</div>';
                return;
            }
            
            // Calculate max weight for each exercise
            const exerciseMaxes = {};
            
            history.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    exercise.sets.forEach(set => {
                        if (!exerciseMaxes[exercise.name] || set.weight > exerciseMaxes[exercise.name]) {
                            exerciseMaxes[exercise.name] = set.weight;
                        }
                    });
                });
            });
            
            // Find global max for scaling
            const globalMax = Math.max(...Object.values(exerciseMaxes));
            
            container.innerHTML = '';
            
            Object.entries(exerciseMaxes).sort((a, b) => b[1] - a[1]).forEach(([exercise, maxWeight]) => {
                const percentage = (maxWeight / globalMax) * 100;
                const barHTML = `
                    <div class="progress-bar-container">
                        <div class="progress-label">${exercise}</div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" style="width: ${percentage}%">
                                    <span class="progress-bar-text">${percentage > 20 ? maxWeight + 'kg' : ''}</span>
                                </div>
                            </div>
                            <div class="progress-value">${maxWeight}kg</div>
                        </div>
                    </div>
                `;
                container.innerHTML += barHTML;
            });
        }

        // Clear history
        function clearHistory() {
            if (confirm('「WARNING」Clear all workout history? This action is irreversible.')) {
                localStorage.removeItem('workoutHistory');
                localStorage.removeItem('exerciseFailures');
                loadHistory();
                updateStats();
            }
        }

        // Export data function
        function exportData(format) {
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            const failures = JSON.parse(localStorage.getItem('exerciseFailures') || '{}');
            
            if (history.length === 0) {
                alert('「NO.DATA」No workout data to export.');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];
            
            if (format === 'json') {
                // Export as JSON
                const data = {
                    workoutHistory: history,
                    exerciseFailures: failures,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `workout-tracker-${timestamp}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('「EXPORT.SUCCESS」JSON data exported successfully.');
            } else if (format === 'csv') {
                // Export as CSV (Excel-friendly)
                let csv = '\uFEFF'; // UTF-8 BOM for Excel compatibility
                csv += 'Date,Day,Exercise,Set Number,Weight (kg),Reps,Completed,Total Volume (kg)\n';
                
                history.forEach(workout => {
                    const date = new Date(workout.date).toLocaleDateString();
                    const dayNames = {
                        'day1': 'Upper Push',
                        'day2': 'Lower Body',
                        'day3': 'Upper Pull',
                        'day4': 'Full Body'
                    };
                    const dayName = dayNames[workout.day] || workout.day;
                    
                    workout.exercises.forEach(exercise => {
                        exercise.sets.forEach((set, index) => {
                            const volume = set.weight * set.reps;
                            const completed = set.completed ? 'Yes' : 'No';
                            // Escape commas in exercise names for CSV
                            const exerciseName = exercise.name.replace(/,/g, ';');
                            csv += `${date},${dayName},${exerciseName},${index + 1},${set.weight},${set.reps},${completed},${volume}\n`;
                        });
                    });
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `workout-tracker-${timestamp}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('「EXPORT.SUCCESS」CSV data exported successfully. Open in Excel for analysis.');
            }
        }

        // Import data function
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.json')) {
                        // Import JSON
                        const data = JSON.parse(content);
                        
                        if (!data.workoutHistory || !Array.isArray(data.workoutHistory)) {
                            throw new Error('Invalid JSON format');
                        }
                        
                        if (confirm('「IMPORT.CONFIRM」This will merge imported data with existing data. Continue?')) {
                            const existingHistory = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                            const existingFailures = JSON.parse(localStorage.getItem('exerciseFailures') || '{}');
                            
                            // Merge histories (avoiding duplicates by date)
                            const mergedHistory = [...data.workoutHistory, ...existingHistory];
                            const uniqueHistory = mergedHistory.filter((workout, index, self) =>
                                index === self.findIndex((w) => w.date === workout.date && w.day === workout.day)
                            );
                            
                            // Merge failures
                            const mergedFailures = { ...existingFailures, ...data.exerciseFailures };
                            
                            localStorage.setItem('workoutHistory', JSON.stringify(uniqueHistory));
                            localStorage.setItem('exerciseFailures', JSON.stringify(mergedFailures));
                            
                            alert('「IMPORT.SUCCESS」Data imported successfully.');
                            location.reload();
                        }
                    } else if (file.name.endsWith('.csv')) {
                        // Import CSV
                        const lines = content.split('\n').filter(line => line.trim());
                        if (lines.length < 2) {
                            throw new Error('CSV file is empty');
                        }
                        
                        // Skip header and BOM
                        const dataLines = lines.slice(1);
                        const workoutMap = {};
                        
                        dataLines.forEach(line => {
                            // Parse CSV line (handle commas in quotes)
                            const values = line.split(',');
                            if (values.length < 7) return;
                            
                            const date = values[0].trim();
                            const day = values[1].trim();
                            const exercise = values[2].trim().replace(/;/g, ','); // Restore commas
                            const setNumber = parseInt(values[3]);
                            const weight = parseFloat(values[4]);
                            const reps = parseInt(values[5]);
                            const completed = values[6].trim().toLowerCase() === 'yes';
                            
                            // Create unique key for workout
                            const workoutKey = `${date}_${day}`;
                            
                            if (!workoutMap[workoutKey]) {
                                // Convert day name back to day key
                                let dayKey = 'day1';
                                if (day.includes('Lower')) dayKey = 'day2';
                                else if (day.includes('Pull')) dayKey = 'day3';
                                else if (day.includes('Full')) dayKey = 'day4';
                                
                                workoutMap[workoutKey] = {
                                    day: dayKey,
                                    date: new Date(date).toISOString(),
                                    exercises: []
                                };
                            }
                            
                            // Find or create exercise
                            let exerciseObj = workoutMap[workoutKey].exercises.find(ex => ex.name === exercise);
                            if (!exerciseObj) {
                                exerciseObj = { name: exercise, sets: [] };
                                workoutMap[workoutKey].exercises.push(exerciseObj);
                            }
                            
                            // Add set
                            exerciseObj.sets.push({ weight, reps, completed });
                        });
                        
                        if (confirm('「IMPORT.CONFIRM」This will merge imported CSV data with existing data. Continue?')) {
                            const existingHistory = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
                            const importedWorkouts = Object.values(workoutMap);
                            
                            // Merge and remove duplicates
                            const mergedHistory = [...importedWorkouts, ...existingHistory];
                            const uniqueHistory = mergedHistory.filter((workout, index, self) =>
                                index === self.findIndex((w) => w.date === workout.date && w.day === workout.day)
                            );
                            
                            localStorage.setItem('workoutHistory', JSON.stringify(uniqueHistory));
                            
                            alert('「IMPORT.SUCCESS」CSV data imported successfully.');
                            location.reload();
                        }
                    }
                } catch (error) {
                    alert('「IMPORT.ERROR」Failed to import data: ' + error.message);
                }
                
                // Reset file input
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        // Initialize on load
        window.onload = function() {
            updateStats();
            loadLastWorkoutData();
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            }
        };
    </script>
</body>
</html>